---
title: "Domain Driven Design Trong .NET: Tá»« TÆ° Duy Äáº¿n Triá»ƒn Khai"
date: "2024-05-01"
description: "TÃ¬m hiá»ƒu Domain Driven Design (DDD) trong .NET vá»›i hÆ°á»›ng dáº«n chi tiáº¿t tá»« tÆ° duy kiáº¿n trÃºc Ä‘áº¿n triá»ƒn khai thá»±c táº¿ báº±ng C#. BÃ i viáº¿t phÃ¹ há»£p cho má»i láº­p trÃ¬nh viÃªn muá»‘n thiáº¿t káº¿ há»‡ thá»‘ng rÃµ rÃ ng, dá»… má»Ÿ rá»™ng."
tags: [".NET", "Domain Driven Design" , "hÆ°á»›ng dáº«n DDD .NET", "DDD architecture", "vÃ­ dá»¥ DDD C#"]
author: "Steve Bang"
readingTime: "12 min read"
image: "/images/domain-driven-design.png"
---
## Giáº£ sá»­ báº¡n má»Ÿ má»™t tiá»‡m cÃ  phÃª
Báº¡n lÃ  chá»§ quÃ¡n cÃ  phÃª. Trong Ä‘áº§u báº¡n cÃ³ má»™t mÃ´ hÃ¬nh vá» cÃ¡ch quÃ¡n hoáº¡t Ä‘á»™ng:

- KhÃ¡ch hÃ ng Ä‘áº¿n => Gá»i mÃ³n => NhÃ¢n viÃªn pha cháº¿ => Mang ra => Thanh toÃ¡n
- CÃ³ nhiá»u loáº¡i Ä‘á»“ uá»‘ng (cÃ  phÃª, trÃ  sá»¯a, nÆ°á»›c Ã©p)
- Má»—i Ä‘Æ¡n hÃ ng cÃ³ thá»ƒ cÃ³ nhiá»u mÃ³n
- Báº¡n cÃ³ nhÃ¢n viÃªn, cÃ³ hÃ³a Ä‘Æ¡n, cÃ³ nguyÃªn liá»‡uâ€¦

ÄÃ³ chÃ­nh lÃ  Domain (Miá»n nghiá»‡p vá»¥) â€” lÃ  tháº¿ giá»›i tháº­t báº¡n Ä‘ang sá»‘ng, vÃ  hiá»ƒu rÃµ nháº¥t.

# Domain Driven Design lÃ  gÃ¬?
Domain Driven Design (DDD) lÃ  má»™t phÆ°Æ¡ng phÃ¡p thiáº¿t káº¿ pháº§n má»m táº­p trung vÃ o **nghiá»‡p vá»¥ trong cÃ¡c á»©ng dá»¥ng .NET**, giÃºp báº¡n xÃ¢y dá»±ng cÃ¡c há»‡ thá»‘ng rÃµ rÃ ng, dá»… báº£o trÃ¬ vÃ  má»Ÿ rá»™ng. Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ cÃ¹ng tÃ¬m hiá»ƒu ká»¹ vá» DDD trong .NET tá»« tÆ° duy Ä‘áº¿n triá»ƒn khai thá»±c táº¿ báº±ng C#.

NÃ³ khÃ´ng chá»‰ lÃ  viáº¿t code cho cháº¡y Ä‘Æ°á»£c lÃ  xong, mÃ  lÃ  viáº¿t code giá»‘ng nhÆ° báº¡n Ä‘ang mÃ´ táº£ quÃ¡n cÃ  phÃª tháº­t sá»±, trong Ä‘Ã³ cÃ³ nhá»¯ng hÃ nh Ä‘á»™ng (method) thá»±c sá»± liÃªn quan Ä‘áº¿n logic nghiá»‡p vá»¥. GiÃºp cho viá»‡c giao tiáº¿p giá»¯a code vÃ  thá»±c táº¿ sáº½ trá»Ÿ nÃªn dá»… dÃ ng, rÃµ rÃ ng vÃ  dá»… phÃ¡t triá»ƒn. 

**DDD hÆ°á»›ng dáº«n báº¡n xÃ¢y dá»±ng pháº§n má»m báº±ng cÃ¡ch:** 

- Táº­p trung vÃ o domain (nghiá»‡p vá»¥):
    - Domain lÃ  lÄ©nh vá»±c mÃ  pháº§n má»m cá»§a báº¡n phá»¥c vá»¥, vÃ­ dá»¥ nhÆ° giÃ¡o dá»¥c, ngÃ¢n hÃ ng, bÃ¡n hÃ ng, v.v.
    - DDD khuyáº¿n khÃ­ch báº¡n hiá»ƒu ká»¹ nghiá»‡p vá»¥ Ä‘Ã³, cÃ¹ng ngá»“i vá»›i chuyÃªn gia nghiá»‡p vá»¥ (domain expert) Ä‘á»ƒ mÃ´ táº£ rÃµ tá»«ng khÃ¡i niá»‡m, quy táº¯c, hÃ nh vi.
- Táº¡o mÃ´ hÃ¬nh nghiá»‡p vá»¥ (domain model):
    - MÃ´ hÃ¬nh nÃ y chÃ­nh lÃ  pháº§n má»m Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn cÃ¡ch hiá»ƒu nghiá»‡p vá»¥.
    - Má»—i khÃ¡i niá»‡m nghiá»‡p vá»¥ Ä‘Æ°á»£c thá»ƒ hiá»‡n báº±ng Entity, Value Object, Service, Aggregate, v.v.
- Sá»­ dá»¥ng "ngÃ´n ngá»¯ chung" (Ubiquitous Language):
    - Táº¥t cáº£ má»i ngÆ°á»i trong team (dev + nghiá»‡p vá»¥) Ä‘á»u dÃ¹ng cÃ¹ng 1 ngÃ´n ngá»¯ mÃ´ táº£ domain.
    - VÃ­ dá»¥: thay vÃ¬ nÃ³i â€œbáº£ng hÃ³a Ä‘Æ¡nâ€, cáº£ team sáº½ dÃ¹ng tá»« â€œOrderâ€, â€œCustomerâ€, â€œLineItemâ€ â€“ vÃ  tá»« Ä‘Ã³ Ä‘i vÃ o code luÃ´n.
- TÃ¡ch biá»‡t giá»¯a logic nghiá»‡p vá»¥ vÃ  háº¡ táº§ng:
    - Domain khÃ´ng bá»‹ phá»¥ thuá»™c vÃ o database, API, UI,...
    - Äiá»u nÃ y giÃºp pháº§n nghiá»‡p vá»¥ cÃ³ thá»ƒ thay Ä‘á»•i linh hoáº¡t theo yÃªu cáº§u, mÃ  khÃ´ng bá»‹ dÃ­nh vÃ o chi tiáº¿t ká»¹ thuáº­t.



â‡’ **Domain Driven Design khÃ´ng pháº£i lÃ  cÃ¡ch viáº¿t code phá»©c táº¡p, mÃ  lÃ  cÃ¡ch viáº¿t code nhÆ° ká»ƒ chuyá»‡n nghiá»‡p vá»¥. Hiá»ƒu chuyá»‡n gÃ¬ Ä‘ang xáº£y ra, chia vai rÃµ rÃ ng, ai lÃ m viá»‡c Ä‘Ã³.**

# MÃ´ hÃ¬nh kiáº¿n trÃºc DDD
DDD thÆ°á»ng Ä‘Æ°á»£c chia theo 4 layer chÃ­nh:

```diff
+---------------------------+
|        Presentation       |  â† UI (API, Web, Mobile, v.v.)
+---------------------------+
|     Application Layer     |  â† Luá»“ng xá»­ lÃ½ nghiá»‡p vá»¥ (Use Cases)
+---------------------------+
|       Domain Layer        |  â† Logic nghiá»‡p vá»¥ â€œxÆ°Æ¡ng sá»‘ngâ€
+---------------------------+
|   Infrastructure Layer    |  â† Giao tiáº¿p vá»›i DB, API, file,...
+---------------------------+

```
## Presentation Layer

**â¤ LÃ  táº§ng â€œgiao diá»‡n ngÆ°á»i dÃ¹ngâ€ â€“ nÆ¡i mÃ  ngÆ°á»i dÃ¹ng sáº½ tÆ°Æ¡ng tÃ¡c vá»›i há»‡ thá»‘ng**

Táº§ng nÃ y cÃ³ thá»ƒ lÃ :
- Web API (giao tiáº¿p qua HTTP)
- Giao diá»‡n Web (React, Razor, Blazor,â€¦)
- Mobile App (gá»­i request qua HTTP)
- Tháº­m chÃ­ cáº£ Command Line (náº¿u cÃ³)

Má»¥c tiÃªu chÃ­nh:
- Nháº­n input tá»« ngÆ°á»i dÃ¹ng
- Gá»­i input Ä‘Ã³ xuá»‘ng Application Layer
- Nháº­n output/result tá»« Application Layer vÃ  tráº£ vá» cho ngÆ°á»i dÃ¹ng

**LÆ°u Ã½ quan trá»ng:** Presentation Layer KHÃ”NG xá»­ lÃ½ logic nghiá»‡p vá»¥
- KhÃ´ng gá»i database trá»±c tiáº¿p
- KhÃ´ng validate phá»©c táº¡p
- KhÃ´ng tá»± Ã½ tÃ­nh toÃ¡n logic nhÆ° giÃ¡, thuáº¿, xÃ¡c thá»±c,...

VÃ­ dá»¥: Báº¡n cÃ³ 1 API táº¡o Ä‘Æ¡n hÃ ng Ä‘á»ƒ xá»­ lÃ½ thÃ¬ báº¡n cáº§n pháº£i cÃ³ 1 táº§ng Controller Ä‘á»ƒ nháº­n request tá»« client gá»­i Ä‘áº¿n. ThÃ¬ nÆ¡i mÃ  nháº­n request nÃ y chÃ­nh lÃ  Presentation. Sau khi nháº­n thÃ´ng tin thÃ¬ sáº½ chuyá»ƒn Ä‘áº¿n táº§ng Application xá»­ lÃ½, á»Ÿ táº§ng nÃ y sáº½ xá»­ lÃ½ lÆ°u trá»¯ database, email thÃ´ng bÃ¡o, kiá»ƒm tra quyá»n gÃ¬ Ä‘Ã³... Sau khi thá»±c hiá»‡n xong thÃ¬ sáº½ tráº£ káº¿t quáº£ vá» cho Presentation Layout vÃ  sáº½ tráº£ vá» káº¿t quáº£ cho client.

## Application Layer
**â¤ ÄÃ¢y lÃ  táº§ng Ä‘iá»u phá»‘i nghiá»‡p vá»¥ (Use Case layer).**
NÃ³ khÃ´ng chá»©a nghiá»‡p vá»¥ phá»©c táº¡p, mÃ  chá»‰ chá»‹u trÃ¡ch nhiá»‡m:
| Vai trÃ² chÃ­nh                  | MÃ´ táº£                                                                        |
| ------------------------------ | ---------------------------------------------------------------------------- |
| âœ… Xá»­ lÃ½ luá»“ng nghiá»‡p vá»¥        | Äiá»u phá»‘i tá»«ng bÆ°á»›c cá»§a má»™t "use case" (táº¡o Ä‘Æ¡n hÃ ng, Ä‘Äƒng kÃ½ tÃ i khoáº£n,...) |
| âœ… Giao tiáº¿p vá»›i Domain Layer   | Gá»i cÃ¡c Aggregate, Service, Repository trong domain                          |
| âœ… Giao tiáº¿p vá»›i Infrastructure | Gá»­i email, lÆ°u DB, ghi log,...                                               |
| âœ… Mapping dá»¯ liá»‡u              | Tá»« DTO â†’ Domain â†’ DTO                                                        |

**ğŸ‘‰ Application Layer giá»‘ng nhÆ° "nháº¡c trÆ°á»Ÿng" Ä‘iá»u khiá»ƒn má»i thÃ nh pháº§n khÃ¡c chÆ¡i Ä‘Ãºng pháº§n cá»§a mÃ¬nh Ä‘á»ƒ Ä‘áº£m báº£o há»‡ thá»‘ng hoáº¡t Ä‘á»™ng tá»‘t ğŸ¼**

**LÆ°u Ã½ quan trá»ng:** KhÃ´ng nÃªn lÃ m gÃ¬ trong Application Layer?
- Business rules: Pháº£i Ä‘Æ°a vÃ o Domain Layer Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh tÃ¡i sá»­ dá»¥ng & báº£o trÃ¬.
- Logic lÆ°u trá»¯: HÃ£y Ä‘á»ƒ cho Infrastructure Ä‘áº£m nhiá»‡m
- Validate: CÃ³ thá»ƒ validate nhÆ°ng validate nÃ y chá»‰ lÃ  nhá»¯ng validate nho nhá» thÃ´i, trong Domain sáº½ lÃ  nÆ¡i validate chÃ­nh xÃ¡c hÆ¡n cho tá»«ng nghiá»‡p vá»¥ tÆ°Æ¡ng á»©ng vá»›i tá»«ng Ä‘á»‘i tÆ°á»£ng


VÃ¬ lÃ  ngÆ°á»i Ä‘iá»u phá»‘i chÃ­nh trong há»‡ thá»‘ng nÃªn táº§ng Application sáº½ cÃ³ thá»ƒ Ä‘áº£m nhiá»‡m nhiá»u nhiá»‡m vá»¥ nhÆ° giao tiáº¿p vá»›i Domain Ä‘á»ƒ xá»­ lÃ½ logic, Infrastructure Ä‘á»ƒ láº¥y data hoáº·c gá»­i email, Mapping dá»¯ liá»‡u, throw exception náº¿u cÃ³. NÃ³i chung lÃ  á»Ÿ dÃ¢y sáº½ cÃ³ ráº¥t nhiá»u use case khÃ¡c nhau Ä‘á»ƒ Ä‘iá»u phá»‘i toÃ n bá»™ há»‡ thá»‘ng hoáº¡t Ä‘á»™ng má»™t cÃ¡ch mÆ°á»£t mÃ .

## Infrastructure Layer
**â¤ ÄÃ¢y lÃ  táº§ng cung cáº¥p cÃ¡c dá»‹ch vá»¥ ká»¹ thuáº­t Ä‘á»ƒ phá»¥c vá»¥ cho cÃ¡c táº§ng khÃ¡c (thÆ°á»ng lÃ  Application vÃ  Domain).**
ÄÃºng vá»›i tÃªn gá»i cá»§a há», pháº§n nÃ y sáº½ lÃ  pháº§n phá»¥ trÃ¡ch vá» tÆ°Æ¡ng tÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u, cung cáº¥p cÃ¡c Repository, gá»­i email Ä‘áº¿n khÃ¡ch hÃ ng, ghi logging, gá»­i notification, tÃ­ch há»£p API tá»« bÃªn thá»© 3, lÆ°u trá»¯ dá»¯ liá»‡u trÃªn cloud, message queue,... ThÃ¬ táº¥t cáº£ cÃ¡c logic xá»­ lÃ½ mÃ  liÃªn quan Ä‘áº¿n phÃ­a sau, phÃ­a dÆ°á»›i thÃ¬ háº§u nhÆ° táº§ng Infrastructure lÃ  nÆ¡i lÃ½ tÆ°á»Ÿng nháº¥t Ä‘á»ƒ xá»­ lÃ½. 
Vai trÃ² chÃ­nh:
| Nhiá»‡m vá»¥               | MÃ´ táº£                                                                  |
| ---------------------- | ---------------------------------------------------------------------- |
| Káº¿t ná»‘i CSDL           | Cung cáº¥p implementation cho Repository, UnitOfWork                     |
| Gá»­i email, log         | Thá»±c thi cÃ¡c dá»‹ch vá»¥ ká»¹ thuáº­t nhÆ° gá»­i email, logging, gá»­i notification |
| TÃ­ch há»£p há»‡ thá»‘ng khÃ¡c | Call API ngoÃ i, queue (RabbitMQ, Kafka), blob storage, v.v.            |
| LÆ°u trá»¯ file           | LÆ°u áº£nh, file, audio,...                                               |

**LÆ°u Ã½ quan trá»ng:**
- Viáº¿t logic nghiá»‡p vá»¥ trong Infrastructure Ä‘iá»u nÃ y sáº½ lÃ m rá»‘i kiáº¿n trÃºc vÃ  khÃ³ cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng
- Gá»i trá»±c tiáº¿p táº§ng Infrastructure tá»« Controller thÃ¬ khÃ´ng chÃ­nh xÃ¡c, pháº£i thÃ´ng qua Application Layer

## Domain Layer 
**â¤LÃ  nÆ¡i Ä‘á»‹nh nghÄ©a nghiá»‡p vá»¥ cá»‘t lÃµi (business logic) cá»§a á»©ng dá»¥ng. NÃ³ pháº£n Ã¡nh cÃ¡ch doanh nghiá»‡p hoáº¡t Ä‘á»™ng, khÃ´ng phá»¥ thuá»™c vÃ o cÃ´ng nghá»‡ nhÆ° database hay framework.**

Domain lÃ  lÄ©nh vá»±c nghiá»‡p vá»¥ mÃ  pháº§n má»m giáº£i quyáº¿t. NÃ³ chÃ­nh lÃ  "tháº¿ giá»›i tháº­t" Ä‘Æ°á»£c pháº£n Ã¡nh trong pháº§n má»m cho ra Ä‘áº¿n ngoÃ i cuá»™c sá»‘ng thá»±c táº¿. Láº­p trÃ¬nh viÃªn sáº½ mÃ´ hÃ¬nh hÃ³a cÃ¡c khÃ¡i niá»‡m nghiá»‡p vá»¥ dÆ°á»›i dáº¡ng mÃ£ nguá»“n.
VÃ­ dá»¥:
- Vá»›i á»©ng dá»¥ng thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­: domain lÃ  bÃ¡n hÃ ng â€“ gá»“m Ä‘Æ¡n hÃ ng, sáº£n pháº©m, giáº£m giÃ¡, thanh toÃ¡n...
- Vá»›i á»©ng dá»¥ng há»c tiáº¿ng Anh: domain lÃ  giÃ¡o dá»¥c â€“ gá»“m há»c viÃªn, bÃ i há»c, Ä‘iá»ƒm sá»‘, chá»©ng chá»‰...

### NgÃ´n ngá»¯ chung (Ubiquitous Language)
Trong DDD, láº­p trÃ¬nh viÃªn vÃ  chuyÃªn gia nghiá»‡p vá»¥ cáº§n dÃ¹ng cÃ¹ng má»™t ngÃ´n ngá»¯. Domain Layer lÃ  nÆ¡i thá»ƒ hiá»‡n rÃµ Ä‘iá»u nÃ y.
| ChuyÃªn gia nghiá»‡p vá»¥ nÃ³i                        | Báº¡n mÃ´ hÃ¬nh báº±ng code                |
| ----------------------------------------------- | ------------------------------------ |
| "Má»™t Ä‘Æ¡n hÃ ng gá»“m nhiá»u sáº£n pháº©m"               | `Order` cÃ³ list `OrderItem`          |
| "Tá»•ng tiá»n Ä‘Æ°á»£c tÃ­nh dá»±a trÃªn sá»‘ lÆ°á»£ng vÃ  giÃ¡"  | `decimal Total => Quantity * Price`  |
| "ÄÆ¡n hÃ ng chá»‰ há»£p lá»‡ náº¿u cÃ³ Ã­t nháº¥t 1 sáº£n pháº©m" | `if (Items.Count == 0) throw new...` |

NÃ³i tÃ³m láº¡i, á»Ÿ trong thá»±c táº¿t 1 nghiá»‡p vá»¥ nhÆ° tháº¿ nÃ o thÃ¬ trong code sáº½ pháº£n áº£nh Ä‘Ãºng vá»›i thá»±c táº¿ nhÆ° váº­y. VÃ  Ä‘Ã¢y cÅ©ng lÃ  Ä‘iá»ƒm then chá»‘t cá»§a mÃ´ hÃ¬nh DDD, tá»©c lÃ  táº¥t cáº£ logic nghiá»‡p vá»¥ Ä‘á» chá»‰ náº±m chung 1 nÆ¡i, khiáº¿n cho viá»‡c báº£o trÃ¬ vÃ  má»Ÿ rá»™ng trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n. 

CÃ³ má»™t nguyÃªn táº¯t báº¥t di báº¥t dá»‹ch mÃ  báº¡n khÃ´ng nÃªn máº¯c pháº£i lÃ : **PHá»¤ THUá»˜C VÃ€O Táº¦NG KHÃC**

### CÃ¡c khá»‘i chÃ­nh trong Domain Layer

#### 1. Entity
KhÃ¡i niá»‡m
- Entity lÃ  thá»±c thá»ƒ nghiá»‡p vá»¥ cá»‘t lÃµi, cÃ³ ID duy nháº¥t Ä‘á»ƒ nháº­n diá»‡n.
- Tráº¡ng thÃ¡i cÃ³ thá»ƒ thay Ä‘á»•i theo thá»i gian.

VÃ­ dá»¥:
```
public class Order
{
    public Guid Id { get; private set; }
    public Guid UserId { get; private set; }
    public List<OrderItem> Items { get; private set; }

    public void AddItem(Guid productId, int quantity, decimal price)
    {
        Items.Add(new OrderItem(productId, quantity, price));
    }
}
```
Order cÃ³ Id duy nháº¥t vÃ  quáº£n lÃ½ danh sÃ¡ch OrderItem. ÄÃ¢y lÃ  Entity gá»‘c (Aggregate Root) cá»§a Ä‘Æ¡n hÃ ng.

#### 2. Value Object â€“ Äá»‘i tÆ°á»£ng giÃ¡ trá»‹
KhÃ¡i niá»‡m
- LÃ  Ä‘á»‘i tÆ°á»£ng khÃ´ng cÃ³ ID, Ä‘áº¡i diá»‡n cho má»™t giÃ¡ trá»‹ thuáº§n tÃºy, báº¥t biáº¿n.
- So sÃ¡nh báº±ng giÃ¡ trá»‹, khÃ´ng pháº£i Ä‘á»‹nh danh.

VÃ­ dá»¥: Email ngÆ°á»i dÃ¹ng
```
public class Email
{
    public string Value { get; }

    public Email(string value)
    {
        if (!value.Contains("@")) throw new ArgumentException("Email khÃ´ng há»£p lá»‡.");
        Value = value;
    }

    public override bool Equals(object? obj) =>
        obj is Email other && Value == other.Value;

    public override int GetHashCode() => Value.GetHashCode();
}

```

#### 3. Aggregate & Aggregate Root
KhÃ¡i niá»‡m:
- Aggregate lÃ  má»™t cá»¥m logic chá»©a cÃ¡c Entity, Value Object liÃªn quan máº­t thiáº¿t.
- Aggregate Root lÃ  cá»•ng duy nháº¥t cho cÃ¡c thao tÃ¡c bÃªn trong Aggregate.

CÃ³ thá»ƒ hiá»ƒu lÃ  má»™t "Ä‘áº¡i diá»‡n" hoáº·c "trÆ°á»Ÿng nhÃ³m" cá»§a má»™t nhÃ³m Ä‘á»‘i tÆ°á»£ng liÃªn quan vá»›i nhau, má»i tÆ°Æ¡ng tÃ¡c vá»›i nhÃ³m Ä‘á»u pháº£i thÃ´ng quan trÆ°á»Ÿng nhÃ³m nÃ y. Chá»© khÃ´ng thá»ƒ tá»± Ã½ thay Ä‘á»•i lÃ m viá»‡c khÃ¡c Ä‘Æ°á»£c.

á» trong láº­p trÃ¬nh thÃ¬ cÃ³ 1 vÃ­ dá»¥ vá» Order:

- Má»™t Order (Ä‘Æ¡n hÃ ng) lÃ  Aggregate Root cá»§a nhÃ³m cÃ¡c mÃ³n hÃ ng (OrderItems).
- Náº¿u báº¡n muá»‘n thÃªm hoáº·c xÃ³a mÃ³n hÃ ng trong Ä‘Æ¡n, báº¡n pháº£i lÃ m qua Order. Báº¡n khÃ´ng thá»ƒ thay Ä‘á»•i má»™t mÃ³n hÃ ng mÃ  khÃ´ng Ä‘i qua Order (Ä‘iá»u nÃ y lÃ  sai nguyÃªn táº¯c).

VÃ­ dá»¥:
```
public class Order // Aggregate Root
{
    public Guid Id { get; private set; }
    private readonly List<OrderItem> _items = new();
    public IReadOnlyList<OrderItem> Items => _items;

    public void AddItem(Guid productId, int qty, decimal price)
    {
        _items.Add(new OrderItem(productId, qty, price));
    }
}

public class OrderItem // Entity con trong Aggregate
{
    public Guid ProductId { get; }
    public int Quantity { get; }
    public decimal Price { get; }

    public OrderItem(Guid productId, int qty, decimal price)
    {
        ProductId = productId;
        Quantity = qty;
        Price = price;
    }
}
```
Order lÃ  Aggregate Root, quáº£n lÃ½ OrderItem. KhÃ´ng thá»ƒ thao tÃ¡c OrderItem Ä‘á»™c láº­p bÃªn ngoÃ i Order.

CÃ³ má»™t máº¹o Ä‘á»ƒ lÆ°u Ã½: **"Má»i Aggregate Root lÃ  Entity, nhÆ°ng khÃ´ng pháº£i má»i Entity lÃ  Aggregate Root."**

#### 4. Domain Service â€“ Dá»‹ch vá»¥ nghiá»‡p vá»¥
KhÃ¡i niá»‡m:
- DÃ¹ng Ä‘á»ƒ xá»­ lÃ½ nghiá»‡p vá»¥ khÃ´ng thuá»™c riÃªng má»™t Entity nÃ o, nhÆ°ng váº«n thuá»™c Domain.
- GiÃºp giá»¯ cho Entity gá»n gÃ ng.

VÃ­ dá»¥: XÃ¡c minh mÃ£ giáº£m giÃ¡
```
public interface IDiscountService
{
    bool IsValidCoupon(string couponCode);
}
```
DiscountService khÃ´ng thuá»™c riÃªng Order, nhÆ°ng liÃªn quan Ä‘áº¿n nghiá»‡p vá»¥ Ä‘áº·t hÃ ng.

#### 5. Domain Event â€“ Sá»± kiá»‡n nghiá»‡p vá»¥
KhÃ¡i niá»‡m:
- LÃ  dáº¥u má»‘c nghiá»‡p vá»¥ Ä‘Ã£ xáº£y ra, giÃºp tÃ¡ch rá»i cÃ¡c logic.
- CÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ gá»­i email, cáº­p nháº­t log, v.v.

VÃ­ dá»¥:
```
public class OrderCreatedEvent
{
    public Guid OrderId { get; }
    public OrderCreatedEvent(Guid orderId) => OrderId = orderId;
}
```
Sau khi Order Ä‘Æ°á»£c táº¡o, OrderCreatedEvent Ä‘Æ°á»£c publish Ä‘á»ƒ xá»­ lÃ½ gá»­i mail hoáº·c thÃ´ng bÃ¡o Ä‘áº¿n há»‡ thá»‘ng khÃ¡c.


#### 6. Repository Interface â€“ Kho dá»¯ liá»‡u trá»«u tÆ°á»£ng
KhÃ¡i niá»‡m:
- Chá»‰ Ä‘á»‹nh cÃ¡ch lÆ°u/truy xuáº¥t dá»¯ liá»‡u mÃ  khÃ´ng quan tÃ¢m chi tiáº¿t ká»¹ thuáº­t (SQL, MongoDB, ...).
- Káº¿t ná»‘i giá»¯a Domain vÃ  Infrastructure.
VÃ­ dá»¥:
```
public interface IOrderRepository
{
    Task<Order?> GetByIdAsync(Guid id);
    Task SaveAsync(Order order);
}
```
á» táº§ng Infrastructure, ta sáº½ cÃ i Ä‘áº·t interface nÃ y báº±ng EF Core hoáº·c báº¥t ká»³ cÃ´ng nghá»‡ nÃ o.


## NguyÃªn táº¯c phá»¥ thuá»™c (Dependency Rule)
NÃ³i Ä‘Æ¡n giáº£n, NguyÃªn táº¯c phá»¥ thuá»™c báº£o ráº±ng: **Má»‘i phá»¥ thuá»™c trong mÃ£ nguá»“n chá»‰ Ä‘Æ°á»£c phÃ©p Ä‘i theo má»™t chiá»u â€” tá»« cÃ¡c lá»›p ngoÃ i cÃ¹ng (vÃ­ dá»¥ nhÆ° UI, Infrastructure) hÆ°á»›ng vÃ o trong (Domain Layer).**

Hay nÃ³i cÃ¡ch khÃ¡c:
- CÃ¡c táº§ng cao cáº¥p (core, domain) khÃ´ng nÃªn biáº¿t hay phá»¥ thuá»™c vÃ o cÃ¡c táº§ng bÃªn ngoÃ i nhÆ° UI, Database, hay Infrastructure.
- NhÆ°ng cÃ¡c táº§ng ngoÃ i cÃ¹ng (vÃ­ dá»¥ Data Access, API, UI) cÃ³ thá»ƒ phá»¥ thuá»™c vÃ o Domain.

Váº­y theo báº¡n vÃ¬ sao láº¡i nhÆ° váº­y?
Domain Layer chá»©a luáº­t nghiá»‡p vá»¥ quan trá»ng nháº¥t cá»§a á»©ng dá»¥ng. NÃ³ pháº£i Ä‘Æ°á»£c báº£o vá»‡, khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi cÃ¡c chi tiáº¿t ká»¹ thuáº­t bÃªn ngoÃ i nhÆ° cÃ¡ch lÆ°u trá»¯, giao diá»‡n ngÆ°á»i dÃ¹ng, hay framework.

Náº¿u Domain Layer phá»¥ thuá»™c vÃ o bÃªn ngoÃ i thÃ¬:
- Ráº¥t khÃ³ Ä‘á»ƒ thay Ä‘á»•i UI hay Database mÃ  khÃ´ng phÃ¡ vá»¡ pháº§n nghiá»‡p vá»¥.
- Dá»… lÃ m cho mÃ£ nguá»“n bá»‹ lá»™n xá»™n, khÃ³ báº£o trÃ¬.

VÃ­ dá»¥ minh há»a:

Giáº£ sá»­ báº¡n cÃ³ 3 táº§ng trong á»©ng dá»¥ng:

- 1. Presentation Layer (giao diá»‡n, API)
- 2. Application Layer (logic Ä‘iá»u phá»‘i)
- 3. Domain Layer (luáº­t nghiá»‡p vá»¥)
- 4. Infrastructure Layer (lÆ°u trá»¯, máº¡ng, file...)

Theo nguyÃªn táº¯c phá»¥ thuá»™c:

- Presentation Layer cÃ³ thá»ƒ gá»i Application Layer.
- Application Layer gá»i Domain Layer.
- Infrastructure Layer cÅ©ng cÃ³ thá»ƒ gá»i Domain Layer (vÃ­ dá»¥ repository triá»ƒn khai interface).
- **NgÆ°á»£c láº¡i, Domain Layer khÃ´ng Ä‘Æ°á»£c gá»i hoáº·c biáº¿t vá» cÃ¡c lá»›p trong Presentation hay Infrastructure.**

# CÃ¡c nguyÃªn táº¯c trong Domain Driven Design 

## Focus on Domain - NguyÃªn táº¯c táº­p trung vÃ o Domain
- LuÃ´n hiá»ƒu rÃµ nghiá»‡p vá»¥, táº­p trung giáº£i quyáº¿t váº¥n Ä‘á» kinh doanh chÃ­nh, chá»© khÃ´ng pháº£i cÃ´ng nghá»‡ hay framework.
- Má»—i dÃ²ng code pháº£i hÆ°á»›ng tá»›i viá»‡c giáº£i quyáº¿t bÃ i toÃ¡n thá»±c táº¿, khÃ´ng lÃ m cho há»‡ thá»‘ng phá»©c táº¡p khÃ´ng cáº§n thiáº¿t.

## Ubiquitous Language - NgÃ´n ngá»¯ chung
- Táº¥t cáº£ má»i ngÆ°á»i trong nhÃ³m (dev, business, testerâ€¦) Ä‘á»u sá»­ dá»¥ng má»™t ngÃ´n ngá»¯ chung, nháº¥t quÃ¡n khi mÃ´ táº£ Domain.
- VÃ­ dá»¥: "Order", "Customer", "Invoice" pháº£i Ä‘Æ°á»£c hiá»ƒu vÃ  dÃ¹ng giá»‘ng nhau trÃªn toÃ n bá»™ há»‡ thá»‘ng, trÃ¡nh hiá»ƒu nháº§m.

## Layered Architecture - TÃ¡ch biá»‡t cÃ¡c lá»›p rÃµ rÃ ng
- PhÃ¢n chia há»‡ thá»‘ng thÃ nh cÃ¡c táº§ng rÃµ rÃ ng nhÆ°:
    - Presentation Layer (giao diá»‡n, API)
    - Application Layer (Ä‘iá»u phá»‘i nghiá»‡p vá»¥)
    - Domain Layer (luáº­t nghiá»‡p vá»¥ cá»‘t lÃµi)
    - Infrastructure Layer (cÆ¡ sá»Ÿ dá»¯ liá»‡u, dá»‹ch vá»¥ bÃªn ngoÃ i)

- Má»—i táº§ng cÃ³ trÃ¡ch nhiá»‡m riÃªng, háº¡n cháº¿ sá»± phá»¥ thuá»™c phá»©c táº¡p.

## Dependency Rule - NguyÃªn táº¯c phá»¥ thuá»™c
- Má»‘i phá»¥ thuá»™c chá»‰ Ä‘Æ°á»£c Ä‘i tá»« ngoÃ i vÃ o trong.
- Domain Layer khÃ´ng Ä‘Æ°á»£c biáº¿t vá» cÃ¡c lá»›p cá»§a Application, Infrastructure hay Presentation Layer.
- Äiá»u nÃ y giÃºp báº£o vá»‡ Domain khá»i sá»± thay Ä‘á»•i khÃ´ng cáº§n thiáº¿t tá»« bÃªn ngoÃ i.

## Sá»­ dá»¥ng Aggregate vÃ  Aggregate Root Ä‘Ãºng cÃ¡ch
- Aggregate lÃ  táº­p há»£p cÃ¡c Entity liÃªn quan vá»›i nhau.
- Aggregate Root lÃ  cá»•ng duy nháº¥t Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i toÃ n bá»™ Aggregate.
- KhÃ´ng Ä‘Æ°á»£c truy cáº­p hoáº·c thay Ä‘á»•i Entity bÃªn trong Aggregate mÃ  khÃ´ng qua Aggregate Root.

## Äá»‹nh nghÄ©a Entity vÃ  Value Object chÃ­nh xÃ¡c
- Entity cÃ³ Ä‘á»‹nh danh riÃªng, tráº¡ng thÃ¡i cÃ³ thá»ƒ thay Ä‘á»•i.
- Value Object khÃ´ng cÃ³ Ä‘á»‹nh danh, Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a báº±ng thuá»™c tÃ­nh, báº¥t biáº¿n (immutable).
- TrÃ¡nh nháº§m láº«n Ä‘á»ƒ giá»¯ logic Domain rÃµ rÃ ng.

## Consistency Boundary - Báº£o vá»‡ tÃ­nh nháº¥t quÃ¡n trong Aggregate
- CÃ¡c thay Ä‘á»•i liÃªn quan Ä‘áº¿n Aggregate pháº£i Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n.
- KhÃ´ng Ä‘á»ƒ tÃ¬nh tráº¡ng dá»¯ liá»‡u â€œloang lá»•â€ hoáº·c mÃ¢u thuáº«n bÃªn trong Aggregate.

## Thiáº¿t káº¿ theo hÆ°á»›ng mÃ´-Ä‘un (Modularity) vÃ  tÃ¡ch biá»‡t theo Bounded Context
- Chia Domain thÃ nh cÃ¡c Bounded Context riÃªng biá»‡t, má»—i context cÃ³ ngÃ´n ngá»¯, quy táº¯c riÃªng.
- GiÃºp quáº£n lÃ½ phá»©c táº¡p tá»‘t hÆ¡n vÃ  trÃ¡nh trÃ¹ng láº·p logic.

# Nhá»¯ng sai láº§m khi triá»ƒn khai Domain Driven Design

## 1. Hiá»ƒu sai hoáº·c quÃ¡ Ä‘Æ¡n giáº£n hÃ³a Domain
Nhiá»u ngÆ°á»i nghÄ© DDD chá»‰ Ä‘Æ¡n giáº£n lÃ  chia code theo lá»›p Entity, Repository, Service, rá»“i gá»i Ä‘Ã³ lÃ  DDD.

Thá»±c táº¿, DDD lÃ  má»™t triáº¿t lÃ½ thiáº¿t káº¿ há»‡ thá»‘ng xoay quanh viá»‡c hiá»ƒu sÃ¢u nghiá»‡p vá»¥, táº¡o ra ngÃ´n ngá»¯ chung (Ubiquitous Language) vÃ  mÃ´ hÃ¬nh Domain tháº­t chÃ­nh xÃ¡c, khÃ´ng pháº£i chá»‰ lÃ  tá»• chá»©c file/folder.

## 2. Thiáº¿u hiá»ƒu biáº¿t vá» Ubiquitous Language
KhÃ´ng Ä‘á»“ng nháº¥t thuáº­t ngá»¯ giá»¯a dev vÃ  business, dáº«n Ä‘áº¿n hiá»ƒu sai, gÃ¢y lá»—i trong thiáº¿t káº¿ Domain Model.

CÃ³ thá»ƒ dáº«n Ä‘áº¿n code khÃ³ Ä‘á»c, khÃ´ng sÃ¡t thá»±c táº¿ nghiá»‡p vá»¥.

## 3. Bá» qua Bounded Context
Cá»‘ nhá»“i nhÃ©t táº¥t cáº£ nghiá»‡p vá»¥ vÃ o má»™t mÃ´ hÃ¬nh Domain duy nháº¥t, khÃ´ng chia nhá» thÃ nh cÃ¡c Bounded Context riÃªng biá»‡t.

Háº­u quáº£: Domain trá»Ÿ nÃªn cá»“ng ká»nh, khÃ³ báº£o trÃ¬, logic bá»‹ rá»‘i vÃ  dá»… phÃ¡t sinh bug.

## 4. Táº¡o Anemic Domain Model (mÃ´ hÃ¬nh â€œÄ‘áº¡m báº¡câ€)
Chá»‰ cÃ³ cÃ¡c class chá»©a thuá»™c tÃ­nh, khÃ´ng chá»©a logic nghiá»‡p vá»¥.

Nghiá»‡p vá»¥ bá»‹ Ä‘áº©y háº¿t lÃªn Service hoáº·c Application Layer, lÃ m máº¥t Ä‘i sá»©c máº¡nh cá»§a DDD, cÅ©ng nhÆ° lÃ m code khÃ³ má»Ÿ rá»™ng, test.

## 5. Láº¡m dá»¥ng hoáº·c sai cÃ¡ch dÃ¹ng Aggregate Root
DÃ¹ng Aggregate Root sai má»¥c Ä‘Ã­ch, hoáº·c lÃ m Aggregate quÃ¡ lá»›n (God Aggregate), khiáº¿n viá»‡c cáº­p nháº­t dá»¯ liá»‡u khÃ³ khÄƒn, hiá»‡u suáº¥t kÃ©m.

NgÆ°á»£c láº¡i, Aggregate quÃ¡ nhá» hoáº·c khÃ´ng Ä‘á»§ bao quÃ¡t, dáº«n Ä‘áº¿n máº¥t tÃ­nh nháº¥t quÃ¡n.

## 6. Domain Layer phá»¥ thuá»™c Infrastructure hoáº·c UI Layer
Vi pháº¡m NguyÃªn táº¯c phá»¥ thuá»™c khi Ä‘á»ƒ Domain Layer biáº¿t hoáº·c gá»i trá»±c tiáº¿p cÃ¡c táº§ng bÃªn ngoÃ i.

LÃ m giáº£m kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng vÃ  khÃ³ test Domain.

## 7. Thiáº¿u hoáº·c sai cÃ¡ch dÃ¹ng Domain Services
KhÃ´ng tÃ¡ch biá»‡t cÃ¡c nghiá»‡p vá»¥ phá»©c táº¡p khÃ´ng thuá»™c vá» Entity hoáº·c Value Object vÃ o Domain Service.

Nghiá»‡p vá»¥ bá»‹ phÃ¢n tÃ¡n, khÃ³ tÃ¬m hiá»ƒu vÃ  báº£o trÃ¬.

## 8. QuÃ¡ táº­p trung vÃ o ká»¹ thuáº­t, bá» quÃªn nghiá»‡p vá»¥
DÃ¹ng DDD nhÆ° má»™t cÃ´ng cá»¥ ká»¹ thuáº­t, chá»‰ Ä‘á»ƒ Ã¡p dá»¥ng patterns, frameworks, mÃ  khÃ´ng hiá»ƒu rÃµ váº¥n Ä‘á» nghiá»‡p vá»¥ cáº§n giáº£i quyáº¿t.

Káº¿t quáº£ lÃ  xÃ¢y dá»±ng há»‡ thá»‘ng â€œÄ‘áº¹pâ€ vá» máº·t ká»¹ thuáº­t nhÆ°ng khÃ´ng Ä‘Ã¡p á»©ng Ä‘Ãºng nhu cáº§u business.

## 9. KhÃ´ng viáº¿t tests hoáº·c viáº¿t test kÃ©m cháº¥t lÆ°á»£ng cho Domain
Domain Model lÃ  trÃ¡i tim á»©ng dá»¥ng, nhÆ°ng khÃ´ng cÃ³ test tá»‘t sáº½ dá»… gÃ¢y lá»—i khi thay Ä‘á»•i, phÃ¡t triá»ƒn.

## 10. QuÃ¡ phá»©c táº¡p hÃ³a
Cá»‘ gáº¯ng Ã¡p dá»¥ng DDD cho má»i dá»± Ã¡n, ká»ƒ cáº£ dá»± Ã¡n nhá», gÃ¢y ra sá»± phá»©c táº¡p khÃ´ng cáº§n thiáº¿t, lÃ m cháº­m tiáº¿n Ä‘á»™.


## Káº¿t luáº­n
Domain Driven Design (DDD) lÃ  má»™t phÆ°Æ¡ng phÃ¡p thiáº¿t káº¿ pháº§n má»m quan trá»ng giÃºp báº¡n xÃ¢y dá»±ng cÃ¡c á»©ng dá»¥ng .NET cÃ³ cáº¥u trÃºc rÃµ rÃ ng, dá»… báº£o trÃ¬ vÃ  dá»… dÃ ng má»Ÿ rá»™ng theo thá»i gian. Khi Ã¡p dá»¥ng Domain Driven Design trong .NET, báº¡n sáº½ dá»… dÃ ng quáº£n lÃ½ cÃ¡c phá»©c táº¡p trong nghiá»‡p vá»¥, tÄƒng tÃ­nh rÃµ rÃ ng cá»§a mÃ£ nguá»“n, Ä‘á»“ng thá»i cáº£i thiá»‡n hiá»‡u quáº£ phÃ¡t triá»ƒn nhÃ³m.

Hy vá»ng bÃ i viáº¿t nÃ y giÃºp báº¡n hiá»ƒu rÃµ hÆ¡n vá» cÃ¡ch Ã¡p dá»¥ng Domain Driven Design (DDD) trong cÃ¡c dá»± Ã¡n .NET thá»±c táº¿, tá»« Ä‘Ã³ nÃ¢ng cao cháº¥t lÆ°á»£ng vÃ  tá»‘c Ä‘á»™ phÃ¡t triá»ƒn pháº§n má»m.

Náº¿u báº¡n muá»‘n tÃ¬m hiá»ƒu sÃ¢u hÆ¡n vá» cÃ¡c ká»¹ thuáº­t nÃ¢ng cao trong Domain Driven Design cho .NET, Ä‘á»«ng ngáº§n ngáº¡i Ä‘Äƒng kÃ½ nháº­n báº£n tin hoáº·c Ä‘á»c thÃªm cÃ¡c bÃ i viáº¿t liÃªn quan bÃªn dÆ°á»›i Ä‘á»ƒ cáº­p nháº­t nhá»¯ng kiáº¿n thá»©c má»›i nháº¥t.

