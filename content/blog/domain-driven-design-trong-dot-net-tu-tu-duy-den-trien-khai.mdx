---
title: "Domain Driven Design Trong .NET: T·ª´ T∆∞ Duy ƒê·∫øn Tri·ªÉn Khai"
date: "2024-05-01"
description: "T√¨m hi·ªÉu Domain Driven Design (DDD) trong .NET v·ªõi h∆∞·ªõng d·∫´n chi ti·∫øt t·ª´ t∆∞ duy ki·∫øn tr√∫c ƒë·∫øn tri·ªÉn khai th·ª±c t·∫ø b·∫±ng C#. B√†i vi·∫øt ph√π h·ª£p cho m·ªçi l·∫≠p tr√¨nh vi√™n mu·ªën thi·∫øt k·∫ø h·ªá th·ªëng r√µ r√†ng, d·ªÖ m·ªü r·ªông."
tags: [".NET", "Domain Driven Design" , "h∆∞·ªõng d·∫´n DDD .NET", "DDD architecture", "v√≠ d·ª• DDD C#"]
author: "Steve Bang"
readingTime: "12 min read"
image: "/images/domain-driven-design.png"
---
## Gi·∫£ s·ª≠ b·∫°n m·ªü m·ªôt ti·ªám c√† ph√™
B·∫°n l√† ch·ªß qu√°n c√† ph√™. Trong ƒë·∫ßu b·∫°n c√≥ m·ªôt m√¥ h√¨nh v·ªÅ c√°ch qu√°n ho·∫°t ƒë·ªông:

- Kh√°ch h√†ng ƒë·∫øn => G·ªçi m√≥n => Nh√¢n vi√™n pha ch·∫ø => Mang ra => Thanh to√°n
- C√≥ nhi·ªÅu lo·∫°i ƒë·ªì u·ªëng (c√† ph√™, tr√† s·ªØa, n∆∞·ªõc √©p)
- M·ªói ƒë∆°n h√†ng c√≥ th·ªÉ c√≥ nhi·ªÅu m√≥n
- B·∫°n c√≥ nh√¢n vi√™n, c√≥ h√≥a ƒë∆°n, c√≥ nguy√™n li·ªáu‚Ä¶

ƒê√≥ ch√≠nh l√† Domain (Mi·ªÅn nghi·ªáp v·ª•) ‚Äî l√† th·∫ø gi·ªõi th·∫≠t b·∫°n ƒëang s·ªëng, v√† hi·ªÉu r√µ nh·∫•t.

# Domain Driven Design l√† g√¨?
Domain Driven Design (DDD) l√† m·ªôt ph∆∞∆°ng ph√°p thi·∫øt k·∫ø ph·∫ßn m·ªÅm t·∫≠p trung v√†o **nghi·ªáp v·ª• trong c√°c ·ª©ng d·ª•ng .NET**, gi√∫p b·∫°n x√¢y d·ª±ng c√°c h·ªá th·ªëng r√µ r√†ng, d·ªÖ b·∫£o tr√¨ v√† m·ªü r·ªông. Trong b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω c√πng t√¨m hi·ªÉu k·ªπ v·ªÅ DDD trong .NET t·ª´ t∆∞ duy ƒë·∫øn tri·ªÉn khai th·ª±c t·∫ø b·∫±ng C#.

N√≥ kh√¥ng ch·ªâ l√† vi·∫øt code cho ch·∫°y ƒë∆∞·ª£c l√† xong, m√† l√† vi·∫øt code gi·ªëng nh∆∞ b·∫°n ƒëang m√¥ t·∫£ qu√°n c√† ph√™ th·∫≠t s·ª±, trong ƒë√≥ c√≥ nh·ªØng h√†nh ƒë·ªông (method) th·ª±c s·ª± li√™n quan ƒë·∫øn logic nghi·ªáp v·ª•. Gi√∫p cho vi·ªác giao ti·∫øp gi·ªØa code v√† th·ª±c t·∫ø s·∫Ω tr·ªü n√™n d·ªÖ d√†ng, r√µ r√†ng v√† d·ªÖ ph√°t tri·ªÉn. 

**DDD h∆∞·ªõng d·∫´n b·∫°n x√¢y d·ª±ng ph·∫ßn m·ªÅm b·∫±ng c√°ch:** 

- T·∫≠p trung v√†o domain (nghi·ªáp v·ª•):
    - Domain l√† lƒ©nh v·ª±c m√† ph·∫ßn m·ªÅm c·ªßa b·∫°n ph·ª•c v·ª•, v√≠ d·ª• nh∆∞ gi√°o d·ª•c, ng√¢n h√†ng, b√°n h√†ng, v.v.
    - DDD khuy·∫øn kh√≠ch b·∫°n hi·ªÉu k·ªπ nghi·ªáp v·ª• ƒë√≥, c√πng ng·ªìi v·ªõi chuy√™n gia nghi·ªáp v·ª• (domain expert) ƒë·ªÉ m√¥ t·∫£ r√µ t·ª´ng kh√°i ni·ªám, quy t·∫Øc, h√†nh vi.
- T·∫°o m√¥ h√¨nh nghi·ªáp v·ª• (domain model):
    - M√¥ h√¨nh n√†y ch√≠nh l√† ph·∫ßn m·ªÅm ƒë∆∞·ª£c x√¢y d·ª±ng d·ª±a tr√™n c√°ch hi·ªÉu nghi·ªáp v·ª•.
    - M·ªói kh√°i ni·ªám nghi·ªáp v·ª• ƒë∆∞·ª£c th·ªÉ hi·ªán b·∫±ng Entity, Value Object, Service, Aggregate, v.v.
- S·ª≠ d·ª•ng "ng√¥n ng·ªØ chung" (Ubiquitous Language):
    - T·∫•t c·∫£ m·ªçi ng∆∞·ªùi trong team (dev + nghi·ªáp v·ª•) ƒë·ªÅu d√πng c√πng 1 ng√¥n ng·ªØ m√¥ t·∫£ domain.
    - V√≠ d·ª•: thay v√¨ n√≥i ‚Äúb·∫£ng h√≥a ƒë∆°n‚Äù, c·∫£ team s·∫Ω d√πng t·ª´ ‚ÄúOrder‚Äù, ‚ÄúCustomer‚Äù, ‚ÄúLineItem‚Äù ‚Äì v√† t·ª´ ƒë√≥ ƒëi v√†o code lu√¥n.
- T√°ch bi·ªát gi·ªØa logic nghi·ªáp v·ª• v√† h·∫° t·∫ßng:
    - Domain kh√¥ng b·ªã ph·ª• thu·ªôc v√†o database, API, UI,...
    - ƒêi·ªÅu n√†y gi√∫p ph·∫ßn nghi·ªáp v·ª• c√≥ th·ªÉ thay ƒë·ªïi linh ho·∫°t theo y√™u c·∫ßu, m√† kh√¥ng b·ªã d√≠nh v√†o chi ti·∫øt k·ªπ thu·∫≠t.



‚áí **Domain Driven Design kh√¥ng ph·∫£i l√† c√°ch vi·∫øt code ph·ª©c t·∫°p, m√† l√† c√°ch vi·∫øt code nh∆∞ k·ªÉ chuy·ªán nghi·ªáp v·ª•. Hi·ªÉu chuy·ªán g√¨ ƒëang x·∫£y ra, chia vai r√µ r√†ng, ai l√†m vi·ªác ƒë√≥.**

# M√¥ h√¨nh ki·∫øn tr√∫c DDD
DDD th∆∞·ªùng ƒë∆∞·ª£c chia theo 4 layer ch√≠nh:

```diff
+---------------------------+
|        Presentation       |  ‚Üê UI (API, Web, Mobile, v.v.)
+---------------------------+
|     Application Layer     |  ‚Üê Lu·ªìng x·ª≠ l√Ω nghi·ªáp v·ª• (Use Cases)
+---------------------------+
|       Domain Layer        |  ‚Üê Logic nghi·ªáp v·ª• ‚Äúx∆∞∆°ng s·ªëng‚Äù
+---------------------------+
|   Infrastructure Layer    |  ‚Üê Giao ti·∫øp v·ªõi DB, API, file,...
+---------------------------+

```
## Presentation Layer

**‚û§ L√† t·∫ßng ‚Äúgiao di·ªán ng∆∞·ªùi d√πng‚Äù ‚Äì n∆°i m√† ng∆∞·ªùi d√πng s·∫Ω t∆∞∆°ng t√°c v·ªõi h·ªá th·ªëng**

T·∫ßng n√†y c√≥ th·ªÉ l√†:
- Web API (giao ti·∫øp qua HTTP)
- Giao di·ªán Web (React, Razor, Blazor,‚Ä¶)
- Mobile App (g·ª≠i request qua HTTP)
- Th·∫≠m ch√≠ c·∫£ Command Line (n·∫øu c√≥)

M·ª•c ti√™u ch√≠nh:
- Nh·∫≠n input t·ª´ ng∆∞·ªùi d√πng
- G·ª≠i input ƒë√≥ xu·ªëng Application Layer
- Nh·∫≠n output/result t·ª´ Application Layer v√† tr·∫£ v·ªÅ cho ng∆∞·ªùi d√πng

**L∆∞u √Ω quan tr·ªçng:** Presentation Layer KH√îNG x·ª≠ l√Ω logic nghi·ªáp v·ª•
- Kh√¥ng g·ªçi database tr·ª±c ti·∫øp
- Kh√¥ng validate ph·ª©c t·∫°p
- Kh√¥ng t·ª± √Ω t√≠nh to√°n logic nh∆∞ gi√°, thu·∫ø, x√°c th·ª±c,...

V√≠ d·ª•: B·∫°n c√≥ 1 API t·∫°o ƒë∆°n h√†ng ƒë·ªÉ x·ª≠ l√Ω th√¨ b·∫°n c·∫ßn ph·∫£i c√≥ 1 t·∫ßng Controller ƒë·ªÉ nh·∫≠n request t·ª´ client g·ª≠i ƒë·∫øn. Th√¨ n∆°i m√† nh·∫≠n request n√†y ch√≠nh l√† Presentation. Sau khi nh·∫≠n th√¥ng tin th√¨ s·∫Ω chuy·ªÉn ƒë·∫øn t·∫ßng Application x·ª≠ l√Ω, ·ªü t·∫ßng n√†y s·∫Ω x·ª≠ l√Ω l∆∞u tr·ªØ database, email th√¥ng b√°o, ki·ªÉm tra quy·ªÅn g√¨ ƒë√≥... Sau khi th·ª±c hi·ªán xong th√¨ s·∫Ω tr·∫£ k·∫øt qu·∫£ v·ªÅ cho Presentation Layout v√† s·∫Ω tr·∫£ v·ªÅ k·∫øt qu·∫£ cho client.

## Application Layer
**‚û§ ƒê√¢y l√† t·∫ßng ƒëi·ªÅu ph·ªëi nghi·ªáp v·ª• (Use Case layer).**
N√≥ kh√¥ng ch·ª©a nghi·ªáp v·ª• ph·ª©c t·∫°p, m√† ch·ªâ ch·ªãu tr√°ch nhi·ªám:
| Vai tr√≤ ch√≠nh                  | M√¥ t·∫£                                                                        |
| ------------------------------ | ---------------------------------------------------------------------------- |
| ‚úÖ X·ª≠ l√Ω lu·ªìng nghi·ªáp v·ª•        | ƒêi·ªÅu ph·ªëi t·ª´ng b∆∞·ªõc c·ªßa m·ªôt "use case" (t·∫°o ƒë∆°n h√†ng, ƒëƒÉng k√Ω t√†i kho·∫£n,...) |
| ‚úÖ Giao ti·∫øp v·ªõi Domain Layer   | G·ªçi c√°c Aggregate, Service, Repository trong domain                          |
| ‚úÖ Giao ti·∫øp v·ªõi Infrastructure | G·ª≠i email, l∆∞u DB, ghi log,...                                               |
| ‚úÖ Mapping d·ªØ li·ªáu              | T·ª´ DTO ‚Üí Domain ‚Üí DTO                                                        |

**üëâ Application Layer gi·ªëng nh∆∞ "nh·∫°c tr∆∞·ªüng" ƒëi·ªÅu khi·ªÉn m·ªçi th√†nh ph·∫ßn kh√°c ch∆°i ƒë√∫ng ph·∫ßn c·ªßa m√¨nh ƒë·ªÉ ƒë·∫£m b·∫£o h·ªá th·ªëng ho·∫°t ƒë·ªông t·ªët üéº**

**L∆∞u √Ω quan tr·ªçng:** Kh√¥ng n√™n l√†m g√¨ trong Application Layer?
- Business rules: Ph·∫£i ƒë∆∞a v√†o Domain Layer ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh t√°i s·ª≠ d·ª•ng & b·∫£o tr√¨.
- Logic l∆∞u tr·ªØ: H√£y ƒë·ªÉ cho Infrastructure ƒë·∫£m nhi·ªám
- Validate: C√≥ th·ªÉ validate nh∆∞ng validate n√†y ch·ªâ l√† nh·ªØng validate nho nh·ªè th√¥i, trong Domain s·∫Ω l√† n∆°i validate ch√≠nh x√°c h∆°n cho t·ª´ng nghi·ªáp v·ª• t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng ƒë·ªëi t∆∞·ª£ng


V√¨ l√† ng∆∞·ªùi ƒëi·ªÅu ph·ªëi ch√≠nh trong h·ªá th·ªëng n√™n t·∫ßng Application s·∫Ω c√≥ th·ªÉ ƒë·∫£m nhi·ªám nhi·ªÅu nhi·ªám v·ª• nh∆∞ giao ti·∫øp v·ªõi Domain ƒë·ªÉ x·ª≠ l√Ω logic, Infrastructure ƒë·ªÉ l·∫•y data ho·∫∑c g·ª≠i email, Mapping d·ªØ li·ªáu, throw exception n·∫øu c√≥. N√≥i chung l√† ·ªü d√¢y s·∫Ω c√≥ r·∫•t nhi·ªÅu use case kh√°c nhau ƒë·ªÉ ƒëi·ªÅu ph·ªëi to√†n b·ªô h·ªá th·ªëng ho·∫°t ƒë·ªông m·ªôt c√°ch m∆∞·ª£t m√†.

## Infrastructure Layer
**‚û§ ƒê√¢y l√† t·∫ßng cung c·∫•p c√°c d·ªãch v·ª• k·ªπ thu·∫≠t ƒë·ªÉ ph·ª•c v·ª• cho c√°c t·∫ßng kh√°c (th∆∞·ªùng l√† Application v√† Domain).**
ƒê√∫ng v·ªõi t√™n g·ªçi c·ªßa h·ªç, ph·∫ßn n√†y s·∫Ω l√† ph·∫ßn ph·ª• tr√°ch v·ªÅ t∆∞∆°ng t√°c c∆° s·ªü d·ªØ li·ªáu, cung c·∫•p c√°c Repository, g·ª≠i email ƒë·∫øn kh√°ch h√†ng, ghi logging, g·ª≠i notification, t√≠ch h·ª£p API t·ª´ b√™n th·ª© 3, l∆∞u tr·ªØ d·ªØ li·ªáu tr√™n cloud, message queue,... Th√¨ t·∫•t c·∫£ c√°c logic x·ª≠ l√Ω m√† li√™n quan ƒë·∫øn ph√≠a sau, ph√≠a d∆∞·ªõi th√¨ h·∫ßu nh∆∞ t·∫ßng Infrastructure l√† n∆°i l√Ω t∆∞·ªüng nh·∫•t ƒë·ªÉ x·ª≠ l√Ω. 
Vai tr√≤ ch√≠nh:
| Nhi·ªám v·ª•               | M√¥ t·∫£                                                                  |
| ---------------------- | ---------------------------------------------------------------------- |
| K·∫øt n·ªëi CSDL           | Cung c·∫•p implementation cho Repository, UnitOfWork                     |
| G·ª≠i email, log         | Th·ª±c thi c√°c d·ªãch v·ª• k·ªπ thu·∫≠t nh∆∞ g·ª≠i email, logging, g·ª≠i notification |
| T√≠ch h·ª£p h·ªá th·ªëng kh√°c | Call API ngo√†i, queue (RabbitMQ, Kafka), blob storage, v.v.            |
| L∆∞u tr·ªØ file           | L∆∞u ·∫£nh, file, audio,...                                               |

**L∆∞u √Ω quan tr·ªçng:**
- Vi·∫øt logic nghi·ªáp v·ª• trong Infrastructure ƒëi·ªÅu n√†y s·∫Ω l√†m r·ªëi ki·∫øn tr√∫c v√† kh√≥ c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng
- G·ªçi tr·ª±c ti·∫øp t·∫ßng Infrastructure t·ª´ Controller th√¨ kh√¥ng ch√≠nh x√°c, ph·∫£i th√¥ng qua Application Layer

## Domain Layer 
**‚û§L√† n∆°i ƒë·ªãnh nghƒ©a nghi·ªáp v·ª• c·ªët l√µi (business logic) c·ªßa ·ª©ng d·ª•ng. N√≥ ph·∫£n √°nh c√°ch doanh nghi·ªáp ho·∫°t ƒë·ªông, kh√¥ng ph·ª• thu·ªôc v√†o c√¥ng ngh·ªá nh∆∞ database hay framework.**

Domain l√† lƒ©nh v·ª±c nghi·ªáp v·ª• m√† ph·∫ßn m·ªÅm gi·∫£i quy·∫øt. N√≥ ch√≠nh l√† "th·∫ø gi·ªõi th·∫≠t" ƒë∆∞·ª£c ph·∫£n √°nh trong ph·∫ßn m·ªÅm cho ra ƒë·∫øn ngo√†i cu·ªôc s·ªëng th·ª±c t·∫ø. L·∫≠p tr√¨nh vi√™n s·∫Ω m√¥ h√¨nh h√≥a c√°c kh√°i ni·ªám nghi·ªáp v·ª• d∆∞·ªõi d·∫°ng m√£ ngu·ªìn.
V√≠ d·ª•:
- V·ªõi ·ª©ng d·ª•ng th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠: domain l√† b√°n h√†ng ‚Äì g·ªìm ƒë∆°n h√†ng, s·∫£n ph·∫©m, gi·∫£m gi√°, thanh to√°n...
- V·ªõi ·ª©ng d·ª•ng h·ªçc ti·∫øng Anh: domain l√† gi√°o d·ª•c ‚Äì g·ªìm h·ªçc vi√™n, b√†i h·ªçc, ƒëi·ªÉm s·ªë, ch·ª©ng ch·ªâ...

### Ng√¥n ng·ªØ chung (Ubiquitous Language)
Trong DDD, l·∫≠p tr√¨nh vi√™n v√† chuy√™n gia nghi·ªáp v·ª• c·∫ßn d√πng c√πng m·ªôt ng√¥n ng·ªØ. Domain Layer l√† n∆°i th·ªÉ hi·ªán r√µ ƒëi·ªÅu n√†y.
| Chuy√™n gia nghi·ªáp v·ª• n√≥i                        | B·∫°n m√¥ h√¨nh b·∫±ng code                |
| ----------------------------------------------- | ------------------------------------ |
| "M·ªôt ƒë∆°n h√†ng g·ªìm nhi·ªÅu s·∫£n ph·∫©m"               | `Order` c√≥ list `OrderItem`          |
| "T·ªïng ti·ªÅn ƒë∆∞·ª£c t√≠nh d·ª±a tr√™n s·ªë l∆∞·ª£ng v√† gi√°"  | `decimal Total => Quantity * Price`  |
| "ƒê∆°n h√†ng ch·ªâ h·ª£p l·ªá n·∫øu c√≥ √≠t nh·∫•t 1 s·∫£n ph·∫©m" | `if (Items.Count == 0) throw new...` |

N√≥i t√≥m l·∫°i, ·ªü trong th·ª±c t·∫øt 1 nghi·ªáp v·ª• nh∆∞ th·∫ø n√†o th√¨ trong code s·∫Ω ph·∫£n ·∫£nh ƒë√∫ng v·ªõi th·ª±c t·∫ø nh∆∞ v·∫≠y. V√† ƒë√¢y c≈©ng l√† ƒëi·ªÉm then ch·ªët c·ªßa m√¥ h√¨nh DDD, t·ª©c l√† t·∫•t c·∫£ logic nghi·ªáp v·ª• ƒë·ªÅ ch·ªâ n·∫±m chung 1 n∆°i, khi·∫øn cho vi·ªác b·∫£o tr√¨ v√† m·ªü r·ªông tr·ªü n√™n d·ªÖ d√†ng h∆°n. 

C√≥ m·ªôt nguy√™n t·∫Øt b·∫•t di b·∫•t d·ªãch m√† b·∫°n kh√¥ng n√™n m·∫Øc ph·∫£i l√†: **PH·ª§ THU·ªòC V√ÄO T·∫¶NG KH√ÅC**

### C√°c kh·ªëi ch√≠nh trong Domain Layer

#### 1. Entity
Kh√°i ni·ªám
- Entity l√† th·ª±c th·ªÉ nghi·ªáp v·ª• c·ªët l√µi, c√≥ ID duy nh·∫•t ƒë·ªÉ nh·∫≠n di·ªán.
- Tr·∫°ng th√°i c√≥ th·ªÉ thay ƒë·ªïi theo th·ªùi gian.

V√≠ d·ª•:
```
public class Order
{
    public Guid Id { get; private set; }
    public Guid UserId { get; private set; }
    public List<OrderItem> Items { get; private set; }

    public void AddItem(Guid productId, int quantity, decimal price)
    {
        Items.Add(new OrderItem(productId, quantity, price));
    }
}
```
Order c√≥ Id duy nh·∫•t v√† qu·∫£n l√Ω danh s√°ch OrderItem. ƒê√¢y l√† Entity g·ªëc (Aggregate Root) c·ªßa ƒë∆°n h√†ng.

#### 2. Value Object ‚Äì ƒê·ªëi t∆∞·ª£ng gi√° tr·ªã
Kh√°i ni·ªám
- L√† ƒë·ªëi t∆∞·ª£ng kh√¥ng c√≥ ID, ƒë·∫°i di·ªán cho m·ªôt gi√° tr·ªã thu·∫ßn t√∫y, b·∫•t bi·∫øn.
- So s√°nh b·∫±ng gi√° tr·ªã, kh√¥ng ph·∫£i ƒë·ªãnh danh.

V√≠ d·ª•: Email ng∆∞·ªùi d√πng
```
public class Email
{
    public string Value { get; }

    public Email(string value)
    {
        if (!value.Contains("@")) throw new ArgumentException("Email kh√¥ng h·ª£p l·ªá.");
        Value = value;
    }

    public override bool Equals(object? obj) =>
        obj is Email other && Value == other.Value;

    public override int GetHashCode() => Value.GetHashCode();
}

```

#### 3. Aggregate & Aggregate Root
Kh√°i ni·ªám:
- Aggregate l√† m·ªôt c·ª•m logic ch·ª©a c√°c Entity, Value Object li√™n quan m·∫≠t thi·∫øt.
- Aggregate Root l√† c·ªïng duy nh·∫•t cho c√°c thao t√°c b√™n trong Aggregate.

C√≥ th·ªÉ hi·ªÉu l√† m·ªôt "ƒë·∫°i di·ªán" ho·∫∑c "tr∆∞·ªüng nh√≥m" c·ªßa m·ªôt nh√≥m ƒë·ªëi t∆∞·ª£ng li√™n quan v·ªõi nhau, m·ªçi t∆∞∆°ng t√°c v·ªõi nh√≥m ƒë·ªÅu ph·∫£i th√¥ng quan tr∆∞·ªüng nh√≥m n√†y. Ch·ª© kh√¥ng th·ªÉ t·ª± √Ω thay ƒë·ªïi l√†m vi·ªác kh√°c ƒë∆∞·ª£c.

·ªû trong l·∫≠p tr√¨nh th√¨ c√≥ 1 v√≠ d·ª• v·ªÅ Order:

- M·ªôt Order (ƒë∆°n h√†ng) l√† Aggregate Root c·ªßa nh√≥m c√°c m√≥n h√†ng (OrderItems).
- N·∫øu b·∫°n mu·ªën th√™m ho·∫∑c x√≥a m√≥n h√†ng trong ƒë∆°n, b·∫°n ph·∫£i l√†m qua Order. B·∫°n kh√¥ng th·ªÉ thay ƒë·ªïi m·ªôt m√≥n h√†ng m√† kh√¥ng ƒëi qua Order (ƒëi·ªÅu n√†y l√† sai nguy√™n t·∫Øc).

V√≠ d·ª•:
```
public class Order // Aggregate Root
{
    public Guid Id { get; private set; }
    private readonly List<OrderItem> _items = new();
    public IReadOnlyList<OrderItem> Items => _items;

    public void AddItem(Guid productId, int qty, decimal price)
    {
        _items.Add(new OrderItem(productId, qty, price));
    }
}

public class OrderItem // Entity con trong Aggregate
{
    public Guid ProductId { get; }
    public int Quantity { get; }
    public decimal Price { get; }

    public OrderItem(Guid productId, int qty, decimal price)
    {
        ProductId = productId;
        Quantity = qty;
        Price = price;
    }
}
```
Order l√† Aggregate Root, qu·∫£n l√Ω OrderItem. Kh√¥ng th·ªÉ thao t√°c OrderItem ƒë·ªôc l·∫≠p b√™n ngo√†i Order.

C√≥ m·ªôt m·∫πo ƒë·ªÉ l∆∞u √Ω: **"M·ªçi Aggregate Root l√† Entity, nh∆∞ng kh√¥ng ph·∫£i m·ªçi Entity l√† Aggregate Root."**

#### 4. Domain Service ‚Äì D·ªãch v·ª• nghi·ªáp v·ª•
Kh√°i ni·ªám:
- D√πng ƒë·ªÉ x·ª≠ l√Ω nghi·ªáp v·ª• kh√¥ng thu·ªôc ri√™ng m·ªôt Entity n√†o, nh∆∞ng v·∫´n thu·ªôc Domain.
- Gi√∫p gi·ªØ cho Entity g·ªçn g√†ng.

V√≠ d·ª•: X√°c minh m√£ gi·∫£m gi√°
```
public interface IDiscountService
{
    bool IsValidCoupon(string couponCode);
}
```
DiscountService kh√¥ng thu·ªôc ri√™ng Order, nh∆∞ng li√™n quan ƒë·∫øn nghi·ªáp v·ª• ƒë·∫∑t h√†ng.

#### 5. Domain Event ‚Äì S·ª± ki·ªán nghi·ªáp v·ª•
Kh√°i ni·ªám:
- L√† d·∫•u m·ªëc nghi·ªáp v·ª• ƒë√£ x·∫£y ra, gi√∫p t√°ch r·ªùi c√°c logic.
- C√≥ th·ªÉ d√πng ƒë·ªÉ g·ª≠i email, c·∫≠p nh·∫≠t log, v.v.

V√≠ d·ª•:
```
public class OrderCreatedEvent
{
    public Guid OrderId { get; }
    public OrderCreatedEvent(Guid orderId) => OrderId = orderId;
}
```
Sau khi Order ƒë∆∞·ª£c t·∫°o, OrderCreatedEvent ƒë∆∞·ª£c publish ƒë·ªÉ x·ª≠ l√Ω g·ª≠i mail ho·∫∑c th√¥ng b√°o ƒë·∫øn h·ªá th·ªëng kh√°c.


#### 6. Repository Interface ‚Äì Kho d·ªØ li·ªáu tr·ª´u t∆∞·ª£ng
Kh√°i ni·ªám:
- Ch·ªâ ƒë·ªãnh c√°ch l∆∞u/truy xu·∫•t d·ªØ li·ªáu m√† kh√¥ng quan t√¢m chi ti·∫øt k·ªπ thu·∫≠t (SQL, MongoDB, ...).
- K·∫øt n·ªëi gi·ªØa Domain v√† Infrastructure.
V√≠ d·ª•:
```
public interface IOrderRepository
{
    Task<Order?> GetByIdAsync(Guid id);
    Task SaveAsync(Order order);
}
```
·ªû t·∫ßng Infrastructure, ta s·∫Ω c√†i ƒë·∫∑t interface n√†y b·∫±ng EF Core ho·∫∑c b·∫•t k·ª≥ c√¥ng ngh·ªá n√†o.


## Nguy√™n t·∫Øc ph·ª• thu·ªôc (Dependency Rule)
N√≥i ƒë∆°n gi·∫£n, Nguy√™n t·∫Øc ph·ª• thu·ªôc b·∫£o r·∫±ng: **M·ªëi ph·ª• thu·ªôc trong m√£ ngu·ªìn ch·ªâ ƒë∆∞·ª£c ph√©p ƒëi theo m·ªôt chi·ªÅu ‚Äî t·ª´ c√°c l·ªõp ngo√†i c√πng (v√≠ d·ª• nh∆∞ UI, Infrastructure) h∆∞·ªõng v√†o trong (Domain Layer).**

Hay n√≥i c√°ch kh√°c:
- C√°c t·∫ßng cao c·∫•p (core, domain) kh√¥ng n√™n bi·∫øt hay ph·ª• thu·ªôc v√†o c√°c t·∫ßng b√™n ngo√†i nh∆∞ UI, Database, hay Infrastructure.
- Nh∆∞ng c√°c t·∫ßng ngo√†i c√πng (v√≠ d·ª• Data Access, API, UI) c√≥ th·ªÉ ph·ª• thu·ªôc v√†o Domain.

V·∫≠y theo b·∫°n v√¨ sao l·∫°i nh∆∞ v·∫≠y?
Domain Layer ch·ª©a lu·∫≠t nghi·ªáp v·ª• quan tr·ªçng nh·∫•t c·ªßa ·ª©ng d·ª•ng. N√≥ ph·∫£i ƒë∆∞·ª£c b·∫£o v·ªá, kh√¥ng b·ªã ·∫£nh h∆∞·ªüng b·ªüi c√°c chi ti·∫øt k·ªπ thu·∫≠t b√™n ngo√†i nh∆∞ c√°ch l∆∞u tr·ªØ, giao di·ªán ng∆∞·ªùi d√πng, hay framework.

N·∫øu Domain Layer ph·ª• thu·ªôc v√†o b√™n ngo√†i th√¨:
- R·∫•t kh√≥ ƒë·ªÉ thay ƒë·ªïi UI hay Database m√† kh√¥ng ph√° v·ª° ph·∫ßn nghi·ªáp v·ª•.
- D·ªÖ l√†m cho m√£ ngu·ªìn b·ªã l·ªôn x·ªôn, kh√≥ b·∫£o tr√¨.

V√≠ d·ª• minh h·ªça:

Gi·∫£ s·ª≠ b·∫°n c√≥ 3 t·∫ßng trong ·ª©ng d·ª•ng:

- 1. Presentation Layer (giao di·ªán, API)
- 2. Application Layer (logic ƒëi·ªÅu ph·ªëi)
- 3. Domain Layer (lu·∫≠t nghi·ªáp v·ª•)
- 4. Infrastructure Layer (l∆∞u tr·ªØ, m·∫°ng, file...)

Theo nguy√™n t·∫Øc ph·ª• thu·ªôc:

- Presentation Layer c√≥ th·ªÉ g·ªçi Application Layer.
- Application Layer g·ªçi Domain Layer.
- Infrastructure Layer c≈©ng c√≥ th·ªÉ g·ªçi Domain Layer (v√≠ d·ª• repository tri·ªÉn khai interface).
- **Ng∆∞·ª£c l·∫°i, Domain Layer kh√¥ng ƒë∆∞·ª£c g·ªçi ho·∫∑c bi·∫øt v·ªÅ c√°c l·ªõp trong Presentation hay Infrastructure.**

# C√°c nguy√™n t·∫Øc trong Domain Driven Design 

## Focus on Domain - Nguy√™n t·∫Øc t·∫≠p trung v√†o Domain
- Lu√¥n hi·ªÉu r√µ nghi·ªáp v·ª•, t·∫≠p trung gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ kinh doanh ch√≠nh, ch·ª© kh√¥ng ph·∫£i c√¥ng ngh·ªá hay framework.
- M·ªói d√≤ng code ph·∫£i h∆∞·ªõng t·ªõi vi·ªác gi·∫£i quy·∫øt b√†i to√°n th·ª±c t·∫ø, kh√¥ng l√†m cho h·ªá th·ªëng ph·ª©c t·∫°p kh√¥ng c·∫ßn thi·∫øt.

## Ubiquitous Language - Ng√¥n ng·ªØ chung
- T·∫•t c·∫£ m·ªçi ng∆∞·ªùi trong nh√≥m (dev, business, tester‚Ä¶) ƒë·ªÅu s·ª≠ d·ª•ng m·ªôt ng√¥n ng·ªØ chung, nh·∫•t qu√°n khi m√¥ t·∫£ Domain.
- V√≠ d·ª•: "Order", "Customer", "Invoice" ph·∫£i ƒë∆∞·ª£c hi·ªÉu v√† d√πng gi·ªëng nhau tr√™n to√†n b·ªô h·ªá th·ªëng, tr√°nh hi·ªÉu nh·∫ßm.

## Layered Architecture - T√°ch bi·ªát c√°c l·ªõp r√µ r√†ng
- Ph√¢n chia h·ªá th·ªëng th√†nh c√°c t·∫ßng r√µ r√†ng nh∆∞:
    - Presentation Layer (giao di·ªán, API)
    - Application Layer (ƒëi·ªÅu ph·ªëi nghi·ªáp v·ª•)
    - Domain Layer (lu·∫≠t nghi·ªáp v·ª• c·ªët l√µi)
    - Infrastructure Layer (c∆° s·ªü d·ªØ li·ªáu, d·ªãch v·ª• b√™n ngo√†i)

- M·ªói t·∫ßng c√≥ tr√°ch nhi·ªám ri√™ng, h·∫°n ch·∫ø s·ª± ph·ª• thu·ªôc ph·ª©c t·∫°p.

## Dependency Rule - Nguy√™n t·∫Øc ph·ª• thu·ªôc
- M·ªëi ph·ª• thu·ªôc ch·ªâ ƒë∆∞·ª£c ƒëi t·ª´ ngo√†i v√†o trong.
- Domain Layer kh√¥ng ƒë∆∞·ª£c bi·∫øt v·ªÅ c√°c l·ªõp c·ªßa Application, Infrastructure hay Presentation Layer.
- ƒêi·ªÅu n√†y gi√∫p b·∫£o v·ªá Domain kh·ªèi s·ª± thay ƒë·ªïi kh√¥ng c·∫ßn thi·∫øt t·ª´ b√™n ngo√†i.

## S·ª≠ d·ª•ng Aggregate v√† Aggregate Root ƒë√∫ng c√°ch
- Aggregate l√† t·∫≠p h·ª£p c√°c Entity li√™n quan v·ªõi nhau.
- Aggregate Root l√† c·ªïng duy nh·∫•t ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi to√†n b·ªô Aggregate.
- Kh√¥ng ƒë∆∞·ª£c truy c·∫≠p ho·∫∑c thay ƒë·ªïi Entity b√™n trong Aggregate m√† kh√¥ng qua Aggregate Root.

## ƒê·ªãnh nghƒ©a Entity v√† Value Object ch√≠nh x√°c
- Entity c√≥ ƒë·ªãnh danh ri√™ng, tr·∫°ng th√°i c√≥ th·ªÉ thay ƒë·ªïi.
- Value Object kh√¥ng c√≥ ƒë·ªãnh danh, ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng thu·ªôc t√≠nh, b·∫•t bi·∫øn (immutable).
- Tr√°nh nh·∫ßm l·∫´n ƒë·ªÉ gi·ªØ logic Domain r√µ r√†ng.

## Consistency Boundary - B·∫£o v·ªá t√≠nh nh·∫•t qu√°n trong Aggregate
- C√°c thay ƒë·ªïi li√™n quan ƒë·∫øn Aggregate ph·∫£i ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n.
- Kh√¥ng ƒë·ªÉ t√¨nh tr·∫°ng d·ªØ li·ªáu ‚Äúloang l·ªï‚Äù ho·∫∑c m√¢u thu·∫´n b√™n trong Aggregate.

## Thi·∫øt k·∫ø theo h∆∞·ªõng m√¥-ƒëun (Modularity) v√† t√°ch bi·ªát theo Bounded Context
- Chia Domain th√†nh c√°c Bounded Context ri√™ng bi·ªát, m·ªói context c√≥ ng√¥n ng·ªØ, quy t·∫Øc ri√™ng.
- Gi√∫p qu·∫£n l√Ω ph·ª©c t·∫°p t·ªët h∆°n v√† tr√°nh tr√πng l·∫∑p logic.

# Nh·ªØng sai l·∫ßm khi tri·ªÉn khai Domain Driven Design

## 1. Hi·ªÉu sai ho·∫∑c qu√° ƒë∆°n gi·∫£n h√≥a Domain
Nhi·ªÅu ng∆∞·ªùi nghƒ© DDD ch·ªâ ƒë∆°n gi·∫£n l√† chia code theo l·ªõp Entity, Repository, Service, r·ªìi g·ªçi ƒë√≥ l√† DDD.

Th·ª±c t·∫ø, DDD l√† m·ªôt tri·∫øt l√Ω thi·∫øt k·∫ø h·ªá th·ªëng xoay quanh vi·ªác hi·ªÉu s√¢u nghi·ªáp v·ª•, t·∫°o ra ng√¥n ng·ªØ chung (Ubiquitous Language) v√† m√¥ h√¨nh Domain th·∫≠t ch√≠nh x√°c, kh√¥ng ph·∫£i ch·ªâ l√† t·ªï ch·ª©c file/folder.

## 2. Thi·∫øu hi·ªÉu bi·∫øt v·ªÅ Ubiquitous Language
Kh√¥ng ƒë·ªìng nh·∫•t thu·∫≠t ng·ªØ gi·ªØa dev v√† business, d·∫´n ƒë·∫øn hi·ªÉu sai, g√¢y l·ªói trong thi·∫øt k·∫ø Domain Model.

C√≥ th·ªÉ d·∫´n ƒë·∫øn code kh√≥ ƒë·ªçc, kh√¥ng s√°t th·ª±c t·∫ø nghi·ªáp v·ª•.

## 3. B·ªè qua Bounded Context
C·ªë nh·ªìi nh√©t t·∫•t c·∫£ nghi·ªáp v·ª• v√†o m·ªôt m√¥ h√¨nh Domain duy nh·∫•t, kh√¥ng chia nh·ªè th√†nh c√°c Bounded Context ri√™ng bi·ªát.

H·∫≠u qu·∫£: Domain tr·ªü n√™n c·ªìng k·ªÅnh, kh√≥ b·∫£o tr√¨, logic b·ªã r·ªëi v√† d·ªÖ ph√°t sinh bug.

## 4. T·∫°o Anemic Domain Model (m√¥ h√¨nh ‚Äúƒë·∫°m b·∫°c‚Äù)
Ch·ªâ c√≥ c√°c class ch·ª©a thu·ªôc t√≠nh, kh√¥ng ch·ª©a logic nghi·ªáp v·ª•.

Nghi·ªáp v·ª• b·ªã ƒë·∫©y h·∫øt l√™n Service ho·∫∑c Application Layer, l√†m m·∫•t ƒëi s·ª©c m·∫°nh c·ªßa DDD, c≈©ng nh∆∞ l√†m code kh√≥ m·ªü r·ªông, test.

## 5. L·∫°m d·ª•ng ho·∫∑c sai c√°ch d√πng Aggregate Root
D√πng Aggregate Root sai m·ª•c ƒë√≠ch, ho·∫∑c l√†m Aggregate qu√° l·ªõn (God Aggregate), khi·∫øn vi·ªác c·∫≠p nh·∫≠t d·ªØ li·ªáu kh√≥ khƒÉn, hi·ªáu su·∫•t k√©m.

Ng∆∞·ª£c l·∫°i, Aggregate qu√° nh·ªè ho·∫∑c kh√¥ng ƒë·ªß bao qu√°t, d·∫´n ƒë·∫øn m·∫•t t√≠nh nh·∫•t qu√°n.

## 6. Domain Layer ph·ª• thu·ªôc Infrastructure ho·∫∑c UI Layer
Vi ph·∫°m Nguy√™n t·∫Øc ph·ª• thu·ªôc khi ƒë·ªÉ Domain Layer bi·∫øt ho·∫∑c g·ªçi tr·ª±c ti·∫øp c√°c t·∫ßng b√™n ngo√†i.

L√†m gi·∫£m kh·∫£ nƒÉng t√°i s·ª≠ d·ª•ng v√† kh√≥ test Domain.

## 7. Thi·∫øu ho·∫∑c sai c√°ch d√πng Domain Services
Kh√¥ng t√°ch bi·ªát c√°c nghi·ªáp v·ª• ph·ª©c t·∫°p kh√¥ng thu·ªôc v·ªÅ Entity ho·∫∑c Value Object v√†o Domain Service.

Nghi·ªáp v·ª• b·ªã ph√¢n t√°n, kh√≥ t√¨m hi·ªÉu v√† b·∫£o tr√¨.

## 8. Qu√° t·∫≠p trung v√†o k·ªπ thu·∫≠t, b·ªè qu√™n nghi·ªáp v·ª•
D√πng DDD nh∆∞ m·ªôt c√¥ng c·ª• k·ªπ thu·∫≠t, ch·ªâ ƒë·ªÉ √°p d·ª•ng patterns, frameworks, m√† kh√¥ng hi·ªÉu r√µ v·∫•n ƒë·ªÅ nghi·ªáp v·ª• c·∫ßn gi·∫£i quy·∫øt.

K·∫øt qu·∫£ l√† x√¢y d·ª±ng h·ªá th·ªëng ‚Äúƒë·∫πp‚Äù v·ªÅ m·∫∑t k·ªπ thu·∫≠t nh∆∞ng kh√¥ng ƒë√°p ·ª©ng ƒë√∫ng nhu c·∫ßu business.

## 9. Kh√¥ng vi·∫øt tests ho·∫∑c vi·∫øt test k√©m ch·∫•t l∆∞·ª£ng cho Domain
Domain Model l√† tr√°i tim ·ª©ng d·ª•ng, nh∆∞ng kh√¥ng c√≥ test t·ªët s·∫Ω d·ªÖ g√¢y l·ªói khi thay ƒë·ªïi, ph√°t tri·ªÉn.

## 10. Qu√° ph·ª©c t·∫°p h√≥a
C·ªë g·∫Øng √°p d·ª•ng DDD cho m·ªçi d·ª± √°n, k·ªÉ c·∫£ d·ª± √°n nh·ªè, g√¢y ra s·ª± ph·ª©c t·∫°p kh√¥ng c·∫ßn thi·∫øt, l√†m ch·∫≠m ti·∫øn ƒë·ªô.


## K·∫øt lu·∫≠n
Domain Driven Design (DDD) l√† m·ªôt ph∆∞∆°ng ph√°p thi·∫øt k·∫ø ph·∫ßn m·ªÅm quan tr·ªçng gi√∫p b·∫°n x√¢y d·ª±ng c√°c ·ª©ng d·ª•ng .NET c√≥ c·∫•u tr√∫c r√µ r√†ng, d·ªÖ b·∫£o tr√¨ v√† d·ªÖ d√†ng m·ªü r·ªông theo th·ªùi gian. Khi √°p d·ª•ng Domain Driven Design trong .NET, b·∫°n s·∫Ω d·ªÖ d√†ng qu·∫£n l√Ω c√°c ph·ª©c t·∫°p trong nghi·ªáp v·ª•, tƒÉng t√≠nh r√µ r√†ng c·ªßa m√£ ngu·ªìn, ƒë·ªìng th·ªùi c·∫£i thi·ªán hi·ªáu qu·∫£ ph√°t tri·ªÉn nh√≥m.

Hy v·ªçng b√†i vi·∫øt n√†y gi√∫p b·∫°n hi·ªÉu r√µ h∆°n v·ªÅ c√°ch √°p d·ª•ng Domain Driven Design (DDD) trong c√°c d·ª± √°n .NET th·ª±c t·∫ø, t·ª´ ƒë√≥ n√¢ng cao ch·∫•t l∆∞·ª£ng v√† t·ªëc ƒë·ªô ph√°t tri·ªÉn ph·∫ßn m·ªÅm.

N·∫øu b·∫°n mu·ªën t√¨m hi·ªÉu s√¢u h∆°n v·ªÅ c√°c k·ªπ thu·∫≠t n√¢ng cao trong Domain Driven Design cho .NET, ƒë·ª´ng ng·∫ßn ng·∫°i ƒëƒÉng k√Ω nh·∫≠n b·∫£n tin ho·∫∑c ƒë·ªçc th√™m c√°c b√†i vi·∫øt li√™n quan b√™n d∆∞·ªõi ƒë·ªÉ c·∫≠p nh·∫≠t nh·ªØng ki·∫øn th·ª©c m·ªõi nh·∫•t.

